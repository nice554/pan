
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>盘点系统</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input { margin: 5px; padding: 5px; }
  table { border-collapse: collapse; margin-top: 15px; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
</style>
</head>
<body>

<h2>盘点系统</h2>

<label>UPC码：</label>
<input type="text" id="upcInput" placeholder="输入UPC码 (12位, 8开头)" maxlength="12">
<button onclick="processUPC()">提交</button>

<table id="recordTable">
  <thead>
    <tr>
      <th>UPC码</th>
      <th>型号</th>
      <th>数量</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// ====== 模拟型号数据库 ======
const modelDB = {
  "800000000001": "型号A",
  "800000000002": "型号B",
  "800000000003": "型号C"
};

// ====== 处理UPC输入 ======
function processUPC() {
  const upc = document.getElementById("upcInput").value.trim();

  // 校验UPC
  if (!/^[8]\d{11}$/.test(upc)) {
    alert("请输入正确的12位UPC码（必须以8开头）！");
    return;
  }

  // 查找型号
  const model = modelDB[upc] || "未知型号";

  // 弹出数量输入
  const qty = parseInt(prompt(`请输入 ${model} 的数量：`, "1"));
  if (!qty || qty <= 0) {
    alert("数量无效！");
    return;
  }

  // 更新表格
  const table = document.getElementById("recordTable").getElementsByTagName("tbody")[0];
  let existingRow = null;

  for (let row of table.rows) {
    if (row.cells[0].innerText === upc) {
      existingRow = row;
      break;
    }
  }

  if (existingRow) {
    existingRow.cells[2].innerText = qty; // 修改数量
  } else {
    const newRow = table.insertRow();
    newRow.insertCell(0).innerText = upc;
    newRow.insertCell(1).innerText = model;
    newRow.insertCell(2).innerText = qty;
  }

  // TODO: 写入 Google Sheet
  // sendToSheet(upc, model, qty);

  document.getElementById("upcInput").value = "";
}

// ====== Google Sheet 接口 ======
async function sendToSheet(upc, model, qty) {
  const sheetId = "YOUR_SHEET_ID"; // <-- 换成你的
  const apiKey = "YOUR_API_KEY";   // <-- 换成你的

  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/盘点!A:C:append?valueInputOption=USER_ENTERED&key=${apiKey}`;

  const body = {
    values: [[upc, model, qty]]
  };

  try {
    const res = await fetch(url, {
      method: "POST",
      body: JSON.stringify(body),
      headers: { "Content-Type": "application/json" }
    });
    console.log(await res.json());
  } catch (err) {
    console.error("写入失败：", err);
  }
}
</script>

</body>
</html>
